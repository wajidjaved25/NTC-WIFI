# PostgreSQL 16 Configuration for Syslog Server
# Hardware: 12 cores, 24GB RAM, 1TB SSD
# Purpose: High-throughput log ingestion with TimescaleDB

# CONNECTIONS
max_connections = 200                    # Balanced for incoming connections
superuser_reserved_connections = 3

# MEMORY SETTINGS (24GB total RAM)
shared_buffers = 6GB                     # 25% of RAM
effective_cache_size = 18GB              # 75% of RAM
work_mem = 32MB                          # Per sort operation
maintenance_work_mem = 1GB               # For VACUUM, CREATE INDEX
autovacuum_work_mem = 512MB

# WRITE AHEAD LOG
wal_buffers = 16MB
min_wal_size = 2GB
max_wal_size = 8GB
checkpoint_completion_target = 0.9
wal_compression = on

# QUERY TUNING (12 cores available)
max_worker_processes = 12
max_parallel_workers_per_gather = 6      # Half of cores
max_parallel_workers = 10                # Leave 2 cores for system
max_parallel_maintenance_workers = 4

# PLANNER
random_page_cost = 1.1                   # SSD optimized
effective_io_concurrency = 200           # For SSD
cpu_tuple_cost = 0.01
cpu_index_tuple_cost = 0.005
cpu_operator_cost = 0.0025

# BACKGROUND WRITER
bgwriter_delay = 200ms
bgwriter_lru_maxpages = 100
bgwriter_lru_multiplier = 2.0

# AUTOVACUUM (Aggressive for high insert rate)
autovacuum = on
autovacuum_max_workers = 4
autovacuum_naptime = 30s                 # Check every 30 seconds
autovacuum_vacuum_scale_factor = 0.05    # Vacuum at 5% dead tuples
autovacuum_analyze_scale_factor = 0.02   # Analyze at 2% changes

# LOGGING
log_line_prefix = '%t [%p]: [%l-1] user=%u,db=%d,app=%a,client=%h '
log_checkpoints = on
log_connections = off
log_disconnections = off
log_lock_waits = on
log_temp_files = 0
log_autovacuum_min_duration = 0

# TIMESCALEDB SPECIFIC
shared_preload_libraries = 'timescaledb'
timescaledb.max_background_workers = 8

# REPLICATION (Optional - disable if not needed)
# wal_level = replica
# max_wal_senders = 0
# max_replication_slots = 0

# STATISTICS
track_activities = on
track_counts = on
track_io_timing = on
track_functions = all
